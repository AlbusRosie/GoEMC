<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test JavaScript Cart</title>
</head>
<body>
    <h1>Test JavaScript Cart Functionality</h1>
    
    <div class="product-options-section">
        <div class="option-group">
            <div class="option-title">Kích thước *</div>
            <div class="option-values">
                <label class="option-value-btn">
                    <input type="radio" name="option_1" value="4x8 feet" class="d-none" required>
                    4x8 feet
                </label>
                <label class="option-value-btn">
                    <input type="radio" name="option_1" value="4x6 feet" class="d-none" required>
                    4x6 feet
                </label>
            </div>
        </div>
        
        <div class="option-group">
            <div class="option-title">Màu sắc *</div>
            <div class="option-values">
                <label class="option-value-btn">
                    <input type="radio" name="option_2" value="Đỏ tự nhiên" class="d-none" required>
                    Đỏ tự nhiên
                </label>
                <label class="option-value-btn">
                    <input type="radio" name="option_2" value="Nâu đậm" class="d-none" required>
                    Nâu đậm
                </label>
            </div>
        </div>
    </div>
    
    <div class="quantity-action">
        <span class="quantity-label">Số lượng:</span>
        <div class="quantity-group">
            <button type="button" onclick="changeQuantity(-1)">-</button>
            <input type="text" id="quantity" value="1" readonly />
            <button type="button" onclick="changeQuantity(1)">+</button>
        </div>
    </div>
    
    <div class="product-action-row">
        <button onclick="addToCart()">THÊM VÀO GIỎ</button>
        <button onclick="buyNow()">MUA NGAY</button>
    </div>
    
    <div id="result"></div>
    
    <script>
        const productOptions = [
            {
                id: 1,
                name: 'Kích thước',
                values: [
                    { id: 1, value: '4x8 feet', stock_quantity: 10 },
                    { id: 2, value: '4x6 feet', stock_quantity: 5 }
                ]
            },
            {
                id: 2,
                name: 'Màu sắc',
                values: [
                    { id: 3, value: 'Đỏ tự nhiên', stock_quantity: 8 },
                    { id: 4, value: 'Nâu đậm', stock_quantity: 6 }
                ]
            }
        ];
        
        function changeQuantity(delta) {
            const quantityInput = document.getElementById('quantity');
            let currentQuantity = parseInt(quantityInput.value);
            currentQuantity = Math.max(1, currentQuantity + delta);
            quantityInput.value = currentQuantity;
        }
        
        function addToCart() {
            const quantity = document.getElementById('quantity').value;
            const productId = 1;
            
            console.log('Adding to cart:', { productId, quantity });
            
            // Validate required options
            const requiredOptions = document.querySelectorAll('input[required]');
            let isValid = true;
            let missingOptions = [];
            
            console.log('Required options found:', requiredOptions.length);
            
            requiredOptions.forEach(input => {
                if (!input.checked) {
                    const optionName = input.closest('.option-group').querySelector('.option-title').textContent.trim();
                    // Remove the asterisk (*) from the option name
                    const cleanOptionName = optionName.replace(/\s*\*$/, '');
                    missingOptions.push(cleanOptionName);
                    isValid = false;
                }
            });
            
            if (!isValid) {
                alert('Vui lòng chọn: ' + missingOptions.join(', '));
                return;
            }
            
            // Get selected options
            const selectedOptions = {};
            productOptions.forEach(option => {
                const selectedValue = document.querySelector(`input[name="option_${option.id}"]:checked`);
                if (selectedValue) {
                    selectedOptions[option.name] = selectedValue.value;
                }
            });
            
            console.log('Selected options:', selectedOptions);
            
            // Prepare data for API
            const cartData = {
                product_id: productId,
                quantity: parseInt(quantity),
                selected_options: Object.keys(selectedOptions).length > 0 ? selectedOptions : null
            };
            
            console.log('Sending cart data:', cartData);
            
            // Send request to API
            fetch('index.php?page=api/cart/add', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(cartData)
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                if (data.success) {
                    alert(data.message);
                } else {
                    alert('Lỗi: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Có lỗi xảy ra khi thêm vào giỏ hàng');
            });
        }
        
        function buyNow() {
            const quantity = document.getElementById('quantity').value;
            
            // Validate required options
            const requiredOptions = document.querySelectorAll('input[required]');
            let isValid = true;
            let missingOptions = [];
            
            requiredOptions.forEach(input => {
                if (!input.checked) {
                    const optionName = input.closest('.option-group').querySelector('.option-title').textContent.trim();
                    // Remove the asterisk (*) from the option name
                    const cleanOptionName = optionName.replace(/\s*\*$/, '');
                    missingOptions.push(cleanOptionName);
                    isValid = false;
                }
            });
            
            if (!isValid) {
                alert('Vui lòng chọn: ' + missingOptions.join(', '));
                return;
            }
            
            alert('Chuyển đến trang thanh toán với ' + quantity + ' sản phẩm!');
        }
    </script>
</body>
</html> 